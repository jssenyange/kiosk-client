<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>KIOSK CLIENT</title>
	<style type="text/css">
		body,html{
			background: #fff;
			font-family: Arial, Helvetica, sans-serif;
			height: 100%;
			width: 100%;
			margin: 0;
			padding: 0;
		}
		body {
			color: #333;
			font-size: 4vmax;
			display: flex;
			flex-direction: column;
			overflow: hidden;
		}

		ul{
			margin-bottom: 0;
		}

		#app {
			height: 100%;
			overflow: hidden;

/*			display: none;*/
		}
		#app .hooper {
			height: 100%;
		}
		#app .hooper-track {
			height: 100%;
		}
		#app .hooper-slide {
			display: flex;
			align-items: center;
			justify-content: center;
			height: 100%;
		}

		img, video{
			width: 100%;
		}

		.hooper-navigation .icon{
			fill: white !important;
			width: 40px !important;
			height: 40px !important;
		}



	</style>
	<link rel="stylesheet" href="../node_modules/hooper/dist/hooper.css">
</head>
<body>

	<video autoplay style="visibility: hidden; position: absolute;"></video>

	<div id="app">
		<hooper ref="hooper" :settings="hooperSettings" @slide="slideChanged" class="slides">
			<slide v-for="(slide, idx) in slides" :key="idx">
				<img :src="host+slide.url" :alt="slide.name" v-if="slide.type == 'image/png'" :id="'slide'+idx" :type="slide.type" :duration="slide.duration">
				<video :src="host+slide.url" v-else-if="slide.type == 'video/mp4'" :id="'slide'+idx" class="video" :type="slide.type"></video>
			</slide>
			<hooper-navigation slot="hooper-addons"></hooper-navigation>

		</hooper>
	</div>
	
	<script src="gest.js"></script>
	<script src="main.js"></script>

	<script>

		const { ipcRenderer } = require('electron');

		ipcRenderer.on('program_loaded', (event, data) => {

			vue.updateSlides(data.items);
		});

		const video = document.querySelector('video');

		const getFrame = () => {
			const canvas = document.createElement('canvas');
			canvas.width = video.videoWidth;
			canvas.height = video.videoHeight;
			canvas.getContext('2d').drawImage(video, 0, 0);
			const data = canvas.toDataURL('image/png');
			return data;
		}


		const FPS = 5;

		navigator.mediaDevices.getUserMedia({
			video: {width: 426, height: 240}
		}).then((stream) => {
			video.srcObject = stream



			setInterval(() => {

				let frame = getFrame();


				ipcRenderer.send("frame", frame);
			}, 1000 / FPS);
		});







		// gest.start();
		// gest.options.debug(true);
		// gest.options.subscribeWithCallback(function(gesture) {


		// 	if(gesture.direction == "Long left"){
		// 		vue.prevSlide();
		// 	}else if(gesture.direction == "Long right"){
		// 		vue.nextSlide();
		// 	}
		// });




	</script>
</body>
</html>
